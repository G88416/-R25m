<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto Genius Pro - Enhanced</title>
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script" crossorigin="anonymous">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/chart.js" as="script" crossorigin="anonymous">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js" as="script" crossorigin="anonymous">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS Configuration - Moved outside global scope if possible for better encapsulation
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#8B5CF6',
                        accent: '#10B981',
                        dark: '#1F2937',
                        danger: '#EF4444',
                        warning: '#F59E0B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Base styles */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Sidebar transitions and responsiveness */
        .sidebar {
            transition: transform 0.3s ease-in-out;
            /* Ensures sidebar is always on top */
            z-index: 50;
        }
        .sidebar-hidden {
            transform: translateX(-100%);
        }

        /* Main content area responsiveness */
        @media (min-width: 768px) {
            .main-content-area {
                margin-left: 16rem; /* md:ml-64 */
            }
            .sidebar-hidden { /* Ensure sidebar is visible on larger screens */
                transform: translateX(0%);
            }
        }

        /* Chart container styling */
        .chart-container {
            max-height: 200px;
            width: 100%;
            position: relative; /* For Chart.js responsiveness */
        }

        /* Number ball styling */
        .number-ball {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px; /* Slightly larger for better UX */
            height: 40px;
            border-radius: 50%;
            background-color: #3B82F6;
            color: white;
            font-weight: bold;
            margin: 5px; /* Increased margin */
            flex-shrink: 0;
            font-size: 1.1rem; /* Larger font size */
        }
        .bonus-ball { background-color: #8B5CF6; }
        .hot-number { background-color: #EF4444; }
        .cold-number { background-color: #3B82F6; }
        .due-number { background-color: #F59E0B; }

        /* General button styling */
        button {
            padding: 0.75rem 1.25rem; /* Enhanced padding */
            border-radius: 0.5rem;
            font-weight: 600; /* Bolder font */
            transition: all 0.2s ease-in-out; /* Smooth transitions for all properties */
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
            transform: translateY(-1px); /* Slight lift on hover */
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Input and textarea styling */
        textarea, input[type="text"], input[type="number"], select {
            padding: 0.75rem; /* Increased padding */
            border-radius: 0.5rem;
            border: 1px solid #D1D5DB;
            background-color: #F9FAFB; /* Light background for inputs */
            color: #1F2937; /* Dark text for inputs */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        textarea:focus, input[type="text"]:focus, input[type="number"]:focus, select:focus {
            border-color: #3B82F6; /* Primary color border on focus */
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3); /* Subtle focus ring */
        }
        .dark textarea, .dark input[type="text"], .dark input[type="number"], .dark select {
            border-color: #4B5563;
            background-color: #374151; /* Darker background in dark mode */
            color: #F9FAFB; /* Light text in dark mode */
        }

        /* Loading indicator */
        .loading-indicator {
            display: inline-block;
            width: 20px; /* Slightly larger */
            height: 20px;
            border: 3px solid rgba(255,255,255,.3); /* Thicker border */
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark text-gray-900 dark:text-white transition-colors duration-300">
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-800 shadow-xl p-6 sidebar z-40 md:translate-x-0 sidebar-hidden" aria-label="Main Navigation">
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-extrabold text-primary flex items-center">
                Lotto Genius <span class="ml-2 px-3 py-1 text-xs bg-accent text-white rounded-full font-bold uppercase tracking-wider">PRO</span>
            </h1>
            <button id="closeSidebar" class="md:hidden text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary rounded-md" aria-label="Close sidebar">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <nav>
            <ul class="space-y-3">
                <li><a href="#dashboard" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200" aria-current="page">üìä Dashboard</a></li>
                <li><a href="#generator" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üé∞ Smart Generator</a></li>
                <li><a href="#analyzer" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üîç Advanced Analyzer</a></li>
                <li><a href="#seed-reverser" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üîÑ Seed Reverser</a></li>
                <li><a href="#historical" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üìà Historical Data</a></li>
                <li><a href="#strategies" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üß† AI Strategies</a></li>
                <li><a href="#probability" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üìâ Probability Lab</a></li>
                <li><a href="#prediction" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">üîÆ Prediction Engine</a></li>
                <li><a href="#settings" class="nav-link flex items-center p-3 text-lg font-medium text-gray-700 dark:text-gray-200 hover:bg-primary hover:text-white rounded-lg transition-colors duration-200">‚öôÔ∏è Settings</a></li>
            </ul>
        </nav>
    </aside>

    <div class="ml-0 p-6 md:p-8 main-content-area transition-all duration-300">
        <header class="flex justify-between items-center mb-8 pb-4 border-b border-gray-200 dark:border-gray-700">
            <button id="toggleSidebar" class="md:hidden p-3 bg-primary text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Open sidebar">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div class="flex items-center space-x-4">
                <button id="themeToggle" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Toggle dark mode">
                    üåô Toggle Theme
                </button>
                <button id="notificationsBtn" class="p-3 bg-secondary text-white rounded-lg relative hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-secondary" aria-label="View notifications">
                    üîî Notifications
                    <span id="notificationBadge" class="absolute -top-2 -right-2 bg-danger text-white text-xs rounded-full h-6 w-6 flex items-center justify-center font-bold hidden" aria-live="polite" aria-atomic="true">0</span>
                </button>
            </div>
        </header>

        <main class="space-y-8">
            <section id="dashboard" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="dashboard-title">
                <h2 id="dashboard-title" class="text-3xl font-bold mb-6 text-primary">Dashboard Overview</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Recent Activity</h3>
                        <div id="recentActivity" class="text-base text-gray-700 dark:text-gray-300">
                            <p>No recent activity</p>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Quick Actions</h3>
                        <div class="flex flex-wrap gap-3">
                            <button class="quick-action p-3 bg-primary text-white rounded-lg text-base hover:bg-blue-700" data-action="quickPick">Quick Pick</button>
                            <button class="quick-action p-3 bg-secondary text-white rounded-lg text-base hover:bg-purple-700" data-action="analyzeLast">Analyze Last</button>
                            <button class="quick-action p-3 bg-accent text-white rounded-lg text-base hover:bg-green-700" data-action="checkOdds">Check Odds</button>
                        </div>
                    </div>
                    <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Statistics</h3>
                        <div id="statsOverview" class="text-base text-gray-700 dark:text-gray-300">
                            <p>Generate numbers to see statistics</p>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Number Frequency Heatmap</h3>
                        <canvas id="dashboardHeatmap" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Recent Patterns</h3>
                        <canvas id="dashboardPatterns" class="chart-container"></canvas>
                    </div>
                </div>
            </section>

            <section id="generator" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="generator-title">
                <h2 id="generator-title" class="text-3xl font-bold mb-6 text-primary">Smart Number Generator</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Game Setup</h3>
                        <div class="space-y-3">
                            <label for="lotteryGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Lottery Game</label>
                            <select id="lotteryGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                                <option value="custom">Custom Game</option>
                            </select>
                        </div>
                        
                        <div id="customGameConfig" class="grid grid-cols-2 gap-4 hidden">
                            <div>
                                <label for="mainPool" class="block text-base font-medium text-gray-700 dark:text-gray-300">Main Pool Max</label>
                                <input id="mainPool" type="number" min="1" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="e.g., 69">
                            </div>
                            <div>
                                <label for="pickCount" class="block text-base font-medium text-gray-700 dark:text-gray-300">Main Pick Count</label>
                                <input id="pickCount" type="number" min="1" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="e.g., 5">
                            </div>
                            <div>
                                <label for="bonusPool" class="block text-base font-medium text-gray-700 dark:text-gray-300">Bonus Pool Max</label>
                                <input id="bonusPool" type="number" min="0" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="e.g., 26">
                            </div>
                            <div>
                                <label for="bonusCount" class="block text-base font-medium text-gray-700 dark:text-gray-300">Bonus Pick Count</label>
                                <input id="bonusCount" type="number" min="0" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="e.g., 1">
                            </div>
                        </div>
                        
                        <div>
                            <label for="randomSeed" class="block text-base font-medium text-gray-700 dark:text-gray-300">Random Seed</label>
                            <div class="flex gap-2">
                                <input id="randomSeed" type="text" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" placeholder="Enter seed for reproducible results">
                                <button id="randomSeedBtn" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700" aria-label="Generate random seed">üé≤</button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Generation Method</h3>
                        <div class="space-y-3">
                            <label for="generationMethod" class="block text-base font-medium text-gray-700 dark:text-gray-300">Algorithm</label>
                            <select id="generationMethod" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="standard">Standard Random</option>
                                <option value="fisherYates">Fisher-Yates Shuffle</option>
                                <option value="crypto">Cryptographically Secure</option>
                                <option value="lowHigh">Low-High Balance</option>
                                <option value="oddEven">Odd-Even Balance</option>
                                <option value="prime">Prime Number Filter</option>
                                <option value="fibonacci">Fibonacci Filter</option>
                                <option value="statistical">Statistical Weighted</option>
                                <option value="ai">AI-Powered ‚ú®</option>
                            </select>
                        </div>
                        
                        <div>
                            <p class="block text-base font-medium text-gray-700 dark:text-gray-300 mb-2">Historical Filters</p>
                            <div class="space-y-2">
                                <label class="flex items-center text-base">
                                    <input id="useHistorical" type="checkbox" class="mr-2 h-5 w-5 text-primary rounded focus:ring-primary"> Use Historical Data
                                </label>
                                <label class="flex items-center text-base">
                                    <input id="favorHot" type="checkbox" class="mr-2 h-5 w-5 text-primary rounded focus:ring-primary"> Favor Hot Numbers
                                </label>
                                <label class="flex items-center text-base">
                                    <input id="includeDue" type="checkbox" class="mr-2 h-5 w-5 text-primary rounded focus:ring-primary"> Include Due Numbers
                                </label>
                                <label class="flex items-center text-base">
                                    <input id="avoidRepeats" type="checkbox" class="mr-2 h-5 w-5 text-primary rounded focus:ring-primary"> Avoid Recent Repeats
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Advanced Options</h3>
                        <div>
                            <label for="numTickets" class="block text-base font-medium text-gray-700 dark:text-gray-300">Number of Tickets</label>
                            <input id="numTickets" type="number" min="1" max="100" value="1" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                        </div>
                        
                        <div>
                            <label for="sumFilter" class="block text-base font-medium text-gray-700 dark:text-gray-300">Sum Filter</label>
                            <select id="sumFilter" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="any">Any Sum</option>
                                <option value="low">Low Sum</option>
                                <option value="medium">Medium Sum</option>
                                <option value="high">High Sum</option>
                                <option value="custom">Custom Range</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="consecutiveFilter" class="block text-base font-medium text-gray-700 dark:text-gray-300">Consecutive Numbers</label>
                            <select id="consecutiveFilter" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="any">Any Consecutives</option>
                                <option value="none">No Consecutives</option>
                                <option value="max1">Max 1 Pair</option>
                                <option value="max2">Max 2 Pairs</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-xl font-semibold mb-4">Actions</h3>
                    <div class="flex flex-wrap gap-3">
                        <button id="generateSmart" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700">Generate Smart Numbers</button>
                        <button id="quickPick" class="p-3 bg-secondary text-white rounded-lg hover:bg-purple-700">Quick Pick (Random)</button>
                        <button id="generateWheeling" class="p-3 bg-accent text-white rounded-lg hover:bg-green-700">Generate Wheeling System</button>
                        <button id="clearGenerator" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600">Clear All</button>
                    </div>
                    <p class="mt-4 text-sm text-gray-600 dark:text-gray-400"><strong>Tip:</strong> Combine AI-Powered generation with historical data for statistically optimized numbers.</p>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold">Generated Tickets</h3>
                        <div class="flex flex-wrap gap-2">
                            <button id="exportTxt" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 text-sm">Export TXT</button>
                            <button id="exportCsv" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 text-sm">Export CSV</button>
                            <button id="copyTickets" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 text-sm">Copy</button>
                            <button id="saveTickets" class="p-2 bg-accent text-white rounded-lg hover:bg-green-700 text-sm">Save</button>
                        </div>
                    </div>
                    <div id="generatedTickets" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] flex flex-wrap items-center justify-center gap-3 text-gray-500 dark:text-gray-400">
                        <p>Generate some numbers to see results</p>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Number Frequency</h3>
                        <canvas id="numberFrequencyChart" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Sum Analysis</h3>
                        <canvas id="sumAnalysisChart" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-3">Pattern Analysis</h3>
                        <canvas id="patternAnalysisChart" class="chart-container"></canvas>
                    </div>
                </div>
            </section>

            <section id="analyzer" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="analyzer-title">
                <h2 id="analyzer-title" class="text-3xl font-bold mb-6 text-primary">Advanced Number Analyzer</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Input Numbers</h3>
                        <div class="space-y-3">
                            <label for="analyzerGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Game Type</label>
                            <select id="analyzerGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="numbersToAnalyze" class="block text-base font-medium text-gray-700 dark:text-gray-300">Numbers to Analyze</label>
                            <textarea id="numbersToAnalyze" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 h-32" placeholder="Enter numbers (e.g., 5, 12, 23, 34, 45, 6)" aria-describedby="analyzer-format-tip"></textarea>
                            <p id="analyzer-format-tip" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Formats: <code>5,12,23,34,45,6</code> or <code>5 12 23 34 45 6</code> or <code>5-12-23-34-45-6</code></p>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <button id="analyzeNumbers" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 flex-1">Analyze</button>
                            <button id="getAIInsights" class="p-3 bg-secondary text-white rounded-lg hover:bg-purple-700 flex-1">AI Insights ‚ú®</button>
                            <button id="clearAnalyzer" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600">Clear</button>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Sample Inputs</h4>
                            <div class="text-sm space-y-1">
                                <button class="sample-input text-primary hover:underline focus:outline-none focus:ring-2 focus:ring-primary" data-sample="5,12,23,34,45,6" data-game="powerball">Powerball Sample</button><br>
                                <button class="sample-input text-primary hover:underline focus:outline-none focus:ring-2 focus:ring-primary" data-sample="3,18,29,41,52,15" data-game="megamillions">Mega Millions Sample</button><br>
                                <button class="sample-input text-primary hover:underline focus:outline-none focus:ring-2 focus:ring-primary" data-sample="7,14,21,28,35" data-game="lotto649">Lotto 6/49 Sample</button>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Basic Analysis</h3>
                        <div id="analysisResults" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] text-gray-500 dark:text-gray-400">
                            <p>Enter numbers to analyze them</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Number Properties</h4>
                                <div id="numberProps" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Pattern Analysis</h4>
                                <div id="patternStats" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Visual Analysis</h4>
                            <div id="visualAnalysis" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        
                        <div id="aiInsightsOutput" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md hidden" role="status" aria-live="polite">
                            <h4 class="font-semibold text-base mb-2">AI Insights</h4>
                            <div id="aiInsightsText" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            <div id="aiInsightsLoading" class="loading-indicator mx-auto mt-4 hidden" aria-hidden="true"></div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Advanced Metrics</h3>
                            <button id="exportAnalysis" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 text-sm">Export</button>
                        </div>
                        
                        <div class="grid grid-cols-1 gap-4">
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Basic Statistics</h4>
                                <div id="basicStats" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Advanced Metrics</h4>
                                <div id="advancedMetrics" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Number Frequency</h4>
                            <canvas id="freqDistributionChart" class="chart-container"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h4 class="font-semibold text-base mb-3">Last Digit Distribution</h4>
                        <canvas id="lastDigitDistributionChart" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h4 class="font-semibold text-base mb-3">Number Sum Distribution</h4>
                        <canvas id="sumDistributionChart" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h4 class="font-semibold text-base mb-3">Odd/Even Distribution</h4>
                        <canvas id="oddEvenDistributionChart" class="chart-container"></canvas>
                    </div>
                </div>
            </section>

            <section id="seed-reverser" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="seed-reverser-title">
                <h2 id="seed-reverser-title" class="text-3xl font-bold mb-6 text-primary">Advanced Lotto Seed Reverser</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Input Numbers for Profile</h3>
                        <div class="space-y-3">
                            <label for="seedReverseGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Lottery Game</label>
                            <select id="seedReverseGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                            </select>
                        </div>
                        <div>
                            <label for="numbersToReverse" class="block text-base font-medium text-gray-700 dark:text-gray-300">Numbers to Reverse Analyze</label>
                            <textarea id="numbersToReverse" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 h-32" placeholder="Enter numbers (e.g., 5, 12, 23, 34, 45, 6)" aria-describedby="seed-reverse-format-tip"></textarea>
                            <p id="seed-reverse-format-tip" class="text-xs text-gray-500 dark:text-gray-400 mt-1">Formats: <code>5,12,23,34,45,6</code> or <code>5 12 23 34 45 6</code></p>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <button id="reverseSeedBtn" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 flex-1">Generate Seed Profile</button>
                            <button id="interpretSeedProfile" class="p-3 bg-secondary text-white rounded-lg hover:bg-purple-700 flex-1">Interpret Profile ‚ú®</button>
                            <button id="clearSeedReverse" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600">Clear</button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Generated Seed Profile</h3>
                        <div id="seedProfileResults" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] text-gray-500 dark:text-gray-400">
                            <p>Enter numbers and generate profile</p>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Statistical Characteristics</h4>
                                <div id="seedStats" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Pattern Indicators</h4>
                                <div id="seedPatterns" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                        </div>
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Visual Representation</h4>
                            <div id="seedVisuals" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <div id="seedInterpretationOutput" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md hidden" role="status" aria-live="polite">
                            <h4 class="font-semibold text-base mb-2">AI Interpretation</h4>
                            <div id="seedInterpretationText" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            <div id="seedInterpretationLoading" class="loading-indicator mx-auto mt-4 hidden" aria-hidden="true"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="historical" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="historical-title">
                <h2 id="historical-title" class="text-3xl font-bold mb-6 text-primary">Historical Data Explorer</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Data Source</h3>
                        <div class="space-y-3">
                            <label for="historicalGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Game Type</label>
                            <select id="historicalGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                            </select>
                        </div>
                        
                        <div class="space-y-3">
                            <label for="dataSource" class="block text-base font-medium text-gray-700 dark:text-gray-300">Data Source</label>
                            <select id="dataSource" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="sample">Sample Data (Built-in)</option>
                                <option value="api">Live API (Premium)</option>
                                <option value="csv">Upload CSV</option>
                            </select>
                        </div>
                        
                        <div id="csvUploadContainer" class="hidden space-y-3">
                            <label for="csvUpload" class="block text-base font-medium text-gray-700 dark:text-gray-300">Upload CSV File</label>
                            <input id="csvUpload" type="file" accept=".csv" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">CSV format: <code>Date,Number1,Number2,...,Bonus1,Bonus2</code></p>
                        </div>
                        
                        <div class="space-y-3">
                            <label for="pastDraws" class="block text-base font-medium text-gray-700 dark:text-gray-300">Number of Past Draws</label>
                            <select id="pastDraws" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="10">10</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="500">500</option>
                                <option value="all">All Available</option>
                            </select>
                        </div>
                        
                        <div class="flex flex-wrap gap-3">
                            <button id="loadData" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 flex-1">Load Data</button>
                            <button id="clearHistorical" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600">Clear</button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Data Summary</h3>
                        <div id="dataSummary" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] text-gray-500 dark:text-gray-400">
                            <p>Load historical data to see summary</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Most Frequent</h4>
                                <div id="mostFrequent" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                            <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                                <h4 class="font-semibold text-base mb-2">Least Frequent</h4>
                                <div id="leastFrequent" class="text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Due Numbers</h4>
                            <div id="dueNumbers" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Quick Analysis</h3>
                            <button id="exportHistorical" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 text-sm">Export</button>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Recent Trends</h4>
                            <div id="recentTrends" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Pattern Frequency</h4>
                            <div id="patternFrequency" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                        
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-base mb-2">Sum Statistics</h4>
                            <div id="sumStatistics" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-xl font-semibold mb-4">Historical Draws</h3>
                    <div class="overflow-x-auto rounded-lg shadow-md">
                        <table id="historicalTable" class="w-full text-left whitespace-nowrap">
                            <thead class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 uppercase text-sm">
                                <tr>
                                    <th class="p-3">Date</th>
                                    <th class="p-3">Numbers</th>
                                    <th class="p-3">Bonus</th>
                                    <th class="p-3">Sum</th>
                                    <th class="p-3">Odd/Even</th>
                                </tr>
                            </thead>
                            <tbody class="text-sm divide-y divide-gray-200 dark:divide-gray-700">
                                <tr>
                                    <td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400">Load data to view historical draws</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row justify-between items-center mt-4 gap-3">
                        <div class="text-base text-gray-600 dark:text-gray-400" id="paginationInfo">Showing 0 of 0</div>
                        <div class="flex gap-2">
                            <button id="prevPage" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed" disabled aria-label="Previous page"><</button>
                            <button id="nextPage" class="p-2 bg-primary text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed" disabled aria-label="Next page">></button>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700 grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h4 class="font-semibold text-base mb-3">Number Frequency Heatmap</h4>
                        <canvas id="freqHeatmapChart" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h4 class="font-semibold text-base mb-3">Frequency Over Time</h4>
                        <canvas id="freqOverTimeChart" class="chart-container"></canvas>
                    </div>
                    <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                        <h4 class="font-semibold text-base mb-3">Gap Analysis</h4>
                        <canvas id="gapAnalysisChart" class="chart-container"></canvas>
                    </div>
                </div>
            </section>

            <section id="strategies" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="strategies-title">
                <h2 id="strategies-title" class="text-3xl font-bold mb-6 text-primary">AI-Powered Strategies</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg border-t-4 border-primary shadow-md">
                        <h3 class="text-xl font-semibold">Frequency Analysis</h3>
                        <p class="text-base mt-2 text-gray-700 dark:text-gray-300">Identifies hot (frequently drawn) and cold (rarely drawn) numbers based on historical data patterns.</p>
                        <button class="applyStrategy mt-4 p-3 bg-primary text-white rounded-lg hover:bg-blue-700 w-full" data-strategy="frequency">Apply Strategy</button>
                    </div>
                    
                    <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg border-t-4 border-secondary shadow-md">
                        <h3 class="text-xl font-semibold">Gap Analysis</h3>
                        <p class="text-base mt-2 text-gray-700 dark:text-gray-300">Finds numbers that are statistically "due" to be drawn based on the time since their last appearance.</p>
                        <button class="applyStrategy mt-4 p-3 bg-secondary text-white rounded-lg hover:bg-purple-700 w-full" data-strategy="gap">Apply Strategy</button>
                    </div>
                    
                    <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg border-t-4 border-accent shadow-md">
                        <h3 class="text-xl font-semibold">Pattern Recognition</h3>
                        <p class="text-base mt-2 text-gray-700 dark:text-gray-300">Detects number patterns and sequences that frequently occur in winning combinations.</p>
                        <button class="applyStrategy mt-4 p-3 bg-accent text-white rounded-lg hover:bg-green-700 w-full" data-strategy="pattern">Apply Strategy</button>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-xl font-semibold mb-4">Custom Strategy Builder</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                            <h4 class="font-semibold text-lg mb-3">Strategy Components</h4>
                            <div class="grid grid-cols-2 gap-3">
                                <label class="flex items-center text-base"><input type="checkbox" class="strategyComponent mr-2 h-5 w-5 text-primary rounded focus:ring-primary" value="frequency" checked> Number Frequency</label>
                                <label class="flex items-center text-base"><input type="checkbox" class="strategyComponent mr-2 h-5 w-5 text-primary rounded focus:ring-primary" value="gap" checked> Gap Analysis</label>
                                <label class="flex items-center text-base"><input type="checkbox" class="strategyComponent mr-2 h-5 w-5 text-primary rounded focus:ring-primary" value="pattern"> Pattern Recognition</label>
                                <label class="flex items-center text-base"><input type="checkbox" class="strategyComponent mr-2 h-5 w-5 text-primary rounded focus:ring-primary" value="sum"> Sum Analysis</label>
                                <label class="flex items-center text-base"><input type="checkbox" class="strategyComponent mr-2 h-5 w-5 text-primary rounded focus:ring-primary" value="prime"> Prime Numbers</label>
                                <label class="flex items-center text-base"><input type="checkbox" class="strategyComponent mr-2 h-5 w-5 text-primary rounded focus:ring-primary" value="fibonacci"> Fibonacci Numbers</label>
                            </div>
                        </div>
                        <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                            <h4 class="font-semibold text-lg mb-3">Weighting</h4>
                            <div class="space-y-4">
                                <div>
                                    <label for="freqWeight" class="block text-base font-medium text-gray-700 dark:text-gray-300">Frequency Importance</label>
                                    <input id="freqWeight" type="range" min="0" max="100" value="40" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600">
                                    <span id="freqWeightValue" class="text-sm text-gray-600 dark:text-gray-400">40%</span>
                                </div>
                                <div>
                                    <label for="gapWeight" class="block text-base font-medium text-gray-700 dark:text-gray-300">Gap Importance</label>
                                    <input id="gapWeight" type="range" min="0" max="100" value="30" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600">
                                    <span id="gapWeightValue" class="text-sm text-gray-600 dark:text-gray-400">30%</span>
                                </div>
                                <div>
                                    <label for="patternWeight" class="block text-base font-medium text-gray-700 dark:text-gray-300">Pattern Importance</label>
                                    <input id="patternWeight" type="range" min="0" max="100" value="20" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600">
                                    <span id="patternWeightValue" class="text-sm text-gray-600 dark:text-gray-400">20%</span>
                                </div>
                                <div>
                                    <label for="otherWeight" class="block text-base font-medium text-gray-700 dark:text-gray-300">Other Importance</label>
                                    <input id="otherWeight" type="range" min="0" max="100" value="10" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer dark:bg-gray-600">
                                    <span id="otherWeightValue" class="text-sm text-gray-600 dark:text-gray-400">10%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6">
                        <button id="buildStrategy" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 w-full">Build & Apply Custom Strategy</button>
                    </div>
                </div>

                <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <h3 class="text-xl font-semibold mb-4">Strategy Results</h3>
                    <div id="strategyResults" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] text-gray-500 dark:text-gray-400">
                        <p>Apply a strategy to see recommendations</p>
                    </div>
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                            <h4 class="font-semibold text-lg mb-3">Recommended Numbers</h4>
                            <div id="recommendedNumbers" class="flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-md">
                            <h4 class="font-semibold text-lg mb-3">Strategy Analysis</h4>
                            <div id="strategyAnalysis" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="probability" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="probability-title">
                <h2 id="probability-title" class="text-3xl font-bold mb-6 text-primary">Probability Laboratory</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Probability Calculator</h3>
                        <div class="space-y-3">
                            <label for="probabilityGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Game Type</label>
                            <select id="probabilityGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="calcMainMatch" class="block text-base font-medium text-gray-700 dark:text-gray-300">Main Numbers Match</label>
                                <input id="calcMainMatch" type="number" min="0" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" value="0">
                            </div>
                            <div>
                                <label for="calcBonusMatch" class="block text-base font-medium text-gray-700 dark:text-gray-300">Bonus Numbers Match</label>
                                <input id="calcBonusMatch" type="number" min="0" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600" value="0">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <button id="calculateProbability" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 flex-1">Calculate Probability</button>
                            <button id="clearProbability" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600">Clear</button>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Probability Results</h3>
                        <div id="probabilityResults" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] text-gray-500 dark:text-gray-400">
                            <p>Enter criteria to calculate probability</p>
                        </div>
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-lg mb-3">Probability Distribution</h4>
                            <canvas id="probabilityChart" class="chart-container"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="prediction" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="prediction-title">
                <h2 id="prediction-title" class="text-3xl font-bold mb-6 text-primary">Prediction Engine</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Generate Predictions</h3>
                        <div class="space-y-3">
                            <label for="predictionGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Lottery Game</label>
                            <select id="predictionGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball (5/69 + 1/26)</option>
                                <option value="megamillions">Mega Millions (5/70 + 1/25)</option>
                                <option value="euromillions">EuroMillions (5/50 + 2/12)</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                            </select>
                        </div>
                        <div class="space-y-3">
                            <label for="predictionModel" class="block text-base font-medium text-gray-700 dark:text-gray-300">Prediction Model</label>
                            <select id="predictionModel" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="ai-neural">AI Neural Network (Advanced)</option>
                                <option value="markov-chain">Markov Chain (Probabilistic)</option>
                                <option value="regression">Regression Analysis (Trend-based)</option>
                            </select>
                        </div>
                        <div class="flex flex-wrap gap-3">
                            <button id="generatePrediction" class="p-3 bg-primary text-white rounded-lg hover:bg-blue-700 flex-1">Generate Prediction</button>
                            <button id="clearPrediction" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600">Clear</button>
                        </div>
                        <div id="predictionLoading" class="flex items-center justify-center hidden" role="alert" aria-live="assertive">
                            <span class="loading-indicator mr-2"></span> Generating prediction...
                        </div>
                    </div>

                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Predicted Numbers</h3>
                        <div id="predictionResults" class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[100px] flex flex-wrap items-center justify-center gap-3 text-gray-500 dark:text-gray-400">
                            <p>Generate a prediction to see results</p>
                        </div>
                        <div class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm">
                            <h4 class="font-semibold text-lg mb-3">Prediction Confidence</h4>
                            <canvas id="predictionConfidenceChart" class="chart-container"></canvas>
                        </div>
                        <div id="predictionDetails" class="p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-sm hidden">
                            <h4 class="font-semibold text-lg mb-3">Prediction Details</h4>
                            <div id="predictionDetailsText" class="text-sm text-gray-700 dark:text-gray-300"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="settings" class="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-xl" role="region" aria-labelledby="settings-title">
                <h2 id="settings-title" class="text-3xl font-bold mb-6 text-primary">Settings</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">User Preferences</h3>
                        <div class="space-y-3">
                            <label for="defaultGame" class="block text-base font-medium text-gray-700 dark:text-gray-300">Default Lottery Game</label>
                            <select id="defaultGame" class="w-full p-3 border rounded-lg dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="powerball">Powerball</option>
                                <option value="megamillions">Mega Millions</option>
                                <option value="euromillions">EuroMillions</option>
                                <option value="lotto649">Lotto 6/49</option>
                                <option value="lotto645">Lotto 6/45</option>
                            </select>
                        </div>
                        <div class="space-y-3">
                            <label class="flex items-center text-base">
                                <input id="saveHistoricalData" type="checkbox" class="mr-2 h-5 w-5 text-primary rounded focus:ring-primary" checked> Auto-save Historical Data
                            </label>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Automatically saves generated and analyzed numbers to your local history.</p>
                        </div>
                        <div class="space-y-3">
                            <label class="flex items-center text-base">
                                <input id="enableNotifications" type="checkbox" class="mr-2 h-5 w-5 text-primary rounded focus:ring-primary" checked> Enable Desktop Notifications
                            </label>
                            <p class="text-xs text-gray-500 dark:text-gray-400">Receive alerts for new draws or important updates.</p>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <h3 class="text-xl font-semibold">Data Management</h3>
                        <button id="exportAllData" class="p-3 bg-secondary text-white rounded-lg hover:bg-purple-700 w-full">Export All Data (JSON)</button>
                        <button id="importData" class="p-3 bg-accent text-white rounded-lg hover:bg-green-700 w-full">Import Data (JSON)</button>
                        <button id="clearAllData" class="p-3 bg-danger text-white rounded-lg hover:bg-red-600 w-full">Clear All Local Data</button>
                        <p class="text-xs text-gray-500 dark:text-gray-400">Use with caution. This will remove all saved data from your browser.</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="notificationToastContainer" class="fixed bottom-4 right-4 z-50 space-y-2">
        </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>

    <script>
        // Placeholder for the main application logic
        // It's highly recommended to separate this into app.js and other modules
        // For demonstration, key concepts are outlined here.

        const appState = {
            historicalData: [],
            gameConfig: {
                powerball: { mainPool: 69, pickCount: 5, bonusPool: 26, bonusCount: 1 },
                megamillions: { mainPool: 70, pickCount: 5, bonusPool: 25, bonusCount: 1 },
                euromillions: { mainPool: 50, pickCount: 5, bonusPool: 12, bonusCount: 2 },
                lotto649: { mainPool: 49, pickCount: 6, bonusPool: 0, bonusCount: 0 },
                lotto645: { mainPool: 45, pickCount: 6, bonusPool: 0, bonusCount: 0 },
                custom: { mainPool: 0, pickCount: 0, bonusPool: 0, bonusCount: 0 } // Dynamically set
            },
            currentDraw: null,
            notifications: []
        };

        // Utility Functions (Example: utils.js)
        const Utils = {
            parseNumbers: (input, gameType) => {
                const numbers = input.split(/[, -]+/).map(Number).filter(n => !isNaN(n) && n > 0);
                const config = appState.gameConfig[gameType];
                if (!config) {
                    console.error("Invalid game type for parsing numbers.");
                    return { main: [], bonus: [] };
                }

                // Basic validation based on game config
                const mainNumbers = numbers.slice(0, config.pickCount);
                const bonusNumbers = numbers.slice(config.pickCount, config.pickCount + config.bonusCount);

                return { main: mainNumbers, bonus: bonusNumbers };
            },
            generateRandomNumbers: (count, max) => {
                const numbers = new Set();
                while (numbers.size < count) {
                    numbers.add(Math.floor(Math.random() * max) + 1);
                }
                return Array.from(numbers).sort((a, b) => a - b);
            },
            calculateSum: (numbers) => _.sum(numbers),
            countOddEven: (numbers) => {
                const oddCount = numbers.filter(n => n % 2 !== 0).length;
                return { odd: oddCount, even: numbers.length - oddCount };
            },
            debounce: (func, delay) => {
                let timeout;
                return function(...args) {
                    const context = this;
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(context, args), delay);
                };
            },
            throttle: (func, limit) => {
                let inThrottle;
                return function(...args) {
                    const context = this;
                    if (!inThrottle) {
                        func.apply(context, args);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                };
            },
            exportToCSV: (filename, data) => {
                const csvRows = [];
                // Add header row based on data structure
                const headers = Object.keys(data[0]); // Assuming data is an array of objects
                csvRows.push(headers.join(','));

                for (const row of data) {
                    const values = headers.map(header => {
                        const val = row[header];
                        // Handle potential commas in string values by quoting them
                        return typeof val === 'string' && val.includes(',') ? `"${val}"` : val;
                    });
                    csvRows.push(values.join(','));
                }

                const csvString = csvRows.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },
            exportToTXT: (filename, data) => {
                const textContent = data.join('\n'); // Assuming data is an array of strings (tickets)
                const blob = new Blob([textContent], { type: 'text/plain;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            },
            copyToClipboard: (text) => {
                navigator.clipboard.writeText(text).then(() => {
                    Notifier.showNotification('Copied to clipboard!', 'success');
                }).catch(err => {
                    console.error('Failed to copy: ', err);
                    Notifier.showNotification('Failed to copy to clipboard.', 'error');
                });
            }
        };

        // UI Helpers (Example: ui.js)
        const UI = {
            toggleSidebar: () => {
                const sidebar = document.getElementById('sidebar');
                const mainContent = document.querySelector('.main-content-area');
                sidebar.classList.toggle('sidebar-hidden');
                // Adjust main content margin on small screens for better overlay effect
                if (window.innerWidth < 768) {
                    mainContent.style.marginLeft = sidebar.classList.contains('sidebar-hidden') ? '0' : '16rem';
                }
            },
            toggleTheme: () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            },
            renderNumberBalls: (containerId, numbers, bonusNumbers = [], hotNumbers = [], coldNumbers = [], dueNumbers = []) => {
                const container = document.getElementById(containerId);
                container.innerHTML = '';
                if (numbers.length === 0 && bonusNumbers.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400">No numbers to display.</p>';
                    return;
                }
                const allNumbers = [...numbers, ...bonusNumbers];
                allNumbers.forEach(num => {
                    const ball = document.createElement('span');
                    ball.className = `number-ball ${bonusNumbers.includes(num) ? 'bonus-ball' : ''} ${hotNumbers.includes(num) ? 'hot-number' : ''} ${coldNumbers.includes(num) ? 'cold-number' : ''} ${dueNumbers.includes(num) ? 'due-number' : ''}`;
                    ball.textContent = num;
                    container.appendChild(ball);
                });
            },
            showLoading: (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.classList.remove('hidden');
                }
            },
            hideLoading: (elementId) => {
                const element = document.getElementById(elementId);
                if (element) {
                    element.classList.add('hidden');
                }
            },
            updateChart: (chartInstance, labels, data, label) => {
                if (chartInstance) {
                    chartInstance.data.labels = labels;
                    chartInstance.data.datasets[0].data = data;
                    chartInstance.data.datasets[0].label = label;
                    chartInstance.update();
                }
            },
            initChart: (ctx, type, labels, data, label) => {
                return new Chart(ctx, {
                    type: type,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: label,
                            data: data,
                            backgroundColor: 'rgba(59, 130, 246, 0.6)', // primary color
                            borderColor: '#3B82F6',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            },
            updateNotificationBadge: () => {
                const badge = document.getElementById('notificationBadge');
                const count = appState.notifications.filter(n => !n.read).length;
                if (count > 0) {
                    badge.textContent = count;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            },
            showNotification: (message, type = 'info', duration = 3000) => {
                const container = document.getElementById('notificationToastContainer');
                const toast = document.createElement('div');
                toast.className = `p-4 rounded-lg shadow-lg text-white mb-2 flex items-center justify-between transition-all duration-300 transform translate-x-full opacity-0`;
                
                let bgColor = 'bg-gray-700';
                if (type === 'success') bgColor = 'bg-accent';
                else if (type === 'error') bgColor = 'bg-danger';
                else if (type === 'warning') bgColor = 'bg-warning';
                
                toast.classList.add(bgColor);
                toast.innerHTML = `
                    <span>${message}</span>
                    <button class="ml-4 text-white opacity-75 hover:opacity-100 focus:outline-none close-toast" aria-label="Close notification">
                        &times;
                    </button>
                `;
                container.appendChild(toast);

                // Animate in
                setTimeout(() => {
                    toast.classList.remove('translate-x-full', 'opacity-0');
                    toast.classList.add('translate-x-0', 'opacity-100');
                }, 100); // Small delay to ensure CSS transition applies

                const closeBtn = toast.querySelector('.close-toast');
                closeBtn.addEventListener('click', () => {
                    toast.classList.add('translate-x-full', 'opacity-0');
                    toast.addEventListener('transitionend', () => toast.remove());
                });

                setTimeout(() => {
                    toast.classList.add('translate-x-full', 'opacity-0');
                    toast.addEventListener('transitionend', () => toast.remove());
                }, duration);
            }
        };

        const Notifier = {
            addNotification: (message, type = 'info') => {
                const notification = {
                    id: Date.now(),
                    message,
                    type,
                    read: false,
                    timestamp: new Date()
                };
                appState.notifications.push(notification);
                UI.updateNotificationBadge();
                UI.showNotification(message, type);
            },
            markAllAsRead: () => {
                appState.notifications.forEach(n => n.read = true);
                UI.updateNotificationBadge();
            },
            clearAllNotifications: () => {
                appState.notifications = [];
                UI.updateNotificationBadge();
            }
        };

        // Data Store (Example: dataStore.js)
        const DataStore = {
            saveState: Utils.debounce(() => {
                try {
                    localStorage.setItem('lottoGeniusState', JSON.stringify(appState));
                    console.log("App state saved.");
                } catch (e) {
                    console.error("Failed to save state to localStorage", e);
                    Notifier.showNotification("Failed to save data. Browser storage might be full.", "error");
                }
            }, 1000), // Debounce saving to avoid excessive writes

            loadState: () => {
                try {
                    const savedState = localStorage.getItem('lottoGeniusState');
                    if (savedState) {
                        const parsedState = JSON.parse(savedState);
                        // Merge or replace as needed. Be careful with direct replacement to avoid losing new default configs.
                        Object.assign(appState, parsedState);
                        console.log("App state loaded.");
                    }
                } catch (e) {
                    console.error("Failed to load state from localStorage", e);
                    Notifier.showNotification("Failed to load saved data. Data might be corrupted.", "error");
                    localStorage.removeItem('lottoGeniusState'); // Clear corrupted data
                }
            },

            addHistoricalDraw: (draw) => {
                appState.historicalData.push(draw);
                DataStore.saveState(); // Save state after adding data
                Notifier.showNotification("New draw added to historical data.");
            },
            clearAllData: () => {
                if (confirm("Are you sure you want to clear all local data? This action cannot be undone.")) {
                    localStorage.removeItem('lottoGeniusState');
                    appState.historicalData = [];
                    appState.notifications = [];
                    // Reset other relevant appState properties to initial
                    Notifier.showNotification("All local data cleared successfully.", "success");
                    location.reload(); // Reload page to reflect clean state
                }
            },
            exportAllData: () => {
                const data = JSON.stringify(appState, null, 2);
                Utils.exportToTXT('lotto_genius_data.json', [data]);
            },
            importData: (file) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedState = JSON.parse(e.target.result);
                        if (confirm("Are you sure you want to import data? This will overwrite your current saved data.")) {
                            Object.assign(appState, importedState);
                            DataStore.saveState();
                            Notifier.showNotification("Data imported successfully!", "success");
                            location.reload(); // Reload to apply new state
                        }
                    } catch (error) {
                        Notifier.showNotification("Failed to import data. Invalid JSON file.", "error");
                        console.error("Import error:", error);
                    }
                };
                reader.readAsText(file);
            }
        };

        // Core Lottery Logic (Example: lotteryLogic.js)
        const Lottery = {
            // Game configuration retrieval
            getGameConfig: (gameType) => {
                return appState.gameConfig[gameType];
            },

            // Smart Number Generation (simplified example, full AI logic would be server-side or complex JS)
            generateSmartNumbers: (gameType, options) => {
                const config = Lottery.getGameConfig(gameType);
                if (!config) {
                    Notifier.showNotification("Invalid game configuration.", "error");
                    return [];
                }

                const generatedTickets = [];
                for (let i = 0; i < (options.numTickets || 1); i++) {
                    let mainNumbers = [];
                    let bonusNumbers = [];

                    // Example: AI-Powered logic (placeholder)
                    if (options.generationMethod === 'ai') {
                        // In a real app, this would involve a call to a machine learning model API
                        // For demonstration, let's just make it slightly "smarter" than pure random
                        mainNumbers = Lottery.generateNumbersWithBias(config.pickCount, config.mainPool, appState.historicalData, options);
                        if (config.bonusCount > 0) {
                            bonusNumbers = Lottery.generateNumbersWithBias(config.bonusCount, config.bonusPool, appState.historicalData, options, true);
                        }
                    } else {
                        // Standard random or other basic algorithms
                        mainNumbers = Utils.generateRandomNumbers(config.pickCount, config.mainPool);
                        if (config.bonusCount > 0) {
                            bonusNumbers = Utils.generateRandomNumbers(config.bonusCount, config.bonusPool);
                        }
                    }
                    generatedTickets.push({ main: mainNumbers, bonus: bonusNumbers, timestamp: new Date().toISOString() });
                }
                return generatedTickets;
            },

            generateNumbersWithBias: (count, max, historicalData, options, isBonus = false) => {
                // This is a simplified placeholder for a biased generation
                // A real implementation would involve analyzing historicalData for frequencies, gaps, patterns, etc.
                // and then weighting the random selection based on these analyses.
                let pool = Array.from({ length: max }, (_, i) => i + 1);
                let hotNumbers = []; // Based on historical frequency
                let dueNumbers = []; // Based on historical gaps

                if (options.useHistorical && historicalData.length > 0) {
                    const allNumbers = historicalData.flatMap(d => d.main.concat(d.bonus));
                    const frequencyMap = _.countBy(allNumbers);
                    
                    // Simple hot numbers: top 10% most frequent
                    const sortedFrequencies = Object.entries(frequencyMap).sort((a, b) => b[1] - a[1]);
                    hotNumbers = sortedFrequencies.slice(0, Math.ceil(max * 0.1)).map(item => Number(item[0]));

                    // Simple due numbers: numbers not seen in a while (e.g., last 5 draws)
                    const recentNumbers = historicalData.slice(-5).flatMap(d => d.main.concat(d.bonus));
                    dueNumbers = pool.filter(n => !recentNumbers.includes(n));
                }

                let selectedNumbers = new Set();
                let attempts = 0;
                const maxAttempts = count * 100; // Prevent infinite loops for strict filters

                while (selectedNumbers.size < count && attempts < maxAttempts) {
                    let num;
                    // Prioritize hot/due numbers if options are enabled
                    if (options.favorHot && hotNumbers.length > 0 && Math.random() < 0.3) { // 30% chance to pick hot
                        num = _.sample(hotNumbers);
                    } else if (options.includeDue && dueNumbers.length > 0 && Math.random() < 0.2) { // 20% chance to pick due
                        num = _.sample(dueNumbers);
                    } else {
                        num = _.sample(pool); // Random pick from full pool
                    }

                    if (num && !selectedNumbers.has(num)) {
                        // Add more sophisticated filtering here (sum, odd/even, consecutive)
                        let isValid = true;
                        if (options.sumFilter !== 'any') { /* apply sum filter logic */ }
                        if (options.consecutiveFilter !== 'any') { /* apply consecutive filter logic */ }
                        // Add prime/fibonacci filters here if selected
                        
                        if (isValid) {
                            selectedNumbers.add(num);
                        }
                    }
                    attempts++;
                }
                
                // Fallback if filters are too strict or attempts run out
                while (selectedNumbers.size < count) {
                    selectedNumbers.add(Math.floor(Math.random() * max) + 1);
                }

                return Array.from(selectedNumbers).sort((a, b) => a - b);
            },

            analyzeNumbers: (numbers, bonusNumbers, gameType) => {
                const config = Lottery.getGameConfig(gameType);
                const allNumbers = numbers.concat(bonusNumbers);

                const sum = Utils.calculateSum(allNumbers);
                const { odd, even } = Utils.countOddEven(allNumbers);
                
                // Simple analysis example
                const analysis = {
                    sum: sum,
                    oddEvenRatio: `${odd}/${even}`,
                    min: _.min(allNumbers),
                    max: _.max(allNumbers),
                    average: _.mean(allNumbers).toFixed(2),
                    isConsecutive: numbers.some((n, i, arr) => i > 0 && arr[i - 1] === n - 1),
                    // Add more advanced pattern detection (e.g., high/low groups, consecutive pairs/triplets)
                    // You'd also compare against historical data for 'hot', 'cold', 'due' status
                    hotStatus: 'N/A', // Would require historical data comparison
                    coldStatus: 'N/A',
                    dueStatus: 'N/A'
                };
                return analysis;
            },

            calculateProbability: (gameType, mainMatches, bonusMatches) => {
                const config = Lottery.getGameConfig(gameType);
                if (!config || mainMatches > config.pickCount || bonusMatches > config.bonusCount) {
                    return "Invalid input for probability calculation.";
                }

                const combinations = (n, k) => {
                    if (k < 0 || k > n) return 0;
                    if (k === 0 || k === n) return 1;
                    if (k > n / 2) k = n - k;
                    let res = 1;
                    for (let i = 1; i <= k; ++i) {
                        res = res * (n - i + 1) / i;
                    }
                    return res;
                };

                const totalMainCombinations = combinations(config.mainPool, config.pickCount);
                const totalBonusCombinations = combinations(config.bonusPool, config.bonusCount);

                const winningMainCombinations = combinations(config.pickCount, mainMatches) * combinations(config.mainPool - config.pickCount, config.pickCount - mainMatches);
                const winningBonusCombinations = combinations(config.bonusCount, bonusMatches) * combinations(config.bonusPool - config.bonusCount, config.bonusCount - bonusMatches);

                const probability = (winningMainCombinations / totalMainCombinations) * (winningBonusCombinations / totalBonusCombinations);
                return `1 in ${Math.round(1 / probability).toLocaleString()}`;
            },

            // Placeholder for AI-Prediction function (highly complex, typically backend)
            predictNumbers: async (gameType, model) => {
                UI.showLoading('predictionLoading');
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 2000)); 
                UI.hideLoading('predictionLoading');

                const config = Lottery.getGameConfig(gameType);
                if (!config) return { predictedMain: [], predictedBonus: [], confidence: 0, details: "Invalid game configuration." };

                // In a real application, this would be an API call to a sophisticated ML model
                // For now, let's generate some "predicted" numbers based on a simple algorithm (e.g., hot numbers from historical data)
                const predictedMain = Lottery.generateNumbersWithBias(config.pickCount, config.mainPool, appState.historicalData, { useHistorical: true, favorHot: true });
                const predictedBonus = config.bonusCount > 0 ? Lottery.generateNumbersWithBias(config.bonusCount, config.bonusPool, appState.historicalData, { useHistorical: true, favorHot: true }, true) : [];

                const confidence = Math.random() * 100; // Simulate a confidence score
                const details = `Prediction based on ${model} model, leveraging historical frequency and gap analysis. Confidence score: ${confidence.toFixed(2)}%.`;

                return { predictedMain, predictedBonus, confidence, details };
            }
        };

        // Chart Instances
        let dashboardHeatmapChart, dashboardPatternsChart;
        let numberFrequencyChart, sumAnalysisChart, patternAnalysisChart;
        let freqDistributionChart, lastDigitDistributionChart, sumDistributionChart, oddEvenDistributionChart;
        let freqHeatmapHistoricalChart, freqOverTimeChart, gapAnalysisChart;
        let probabilityChart;
        let predictionConfidenceChart;

        // Event Listeners and Initialization (app.js main entry)
        document.addEventListener('DOMContentLoaded', () => {
            DataStore.loadState();
            UI.updateNotificationBadge();

            // Apply saved theme
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Sidebar Toggles
            document.getElementById('toggleSidebar').addEventListener('click', UI.toggleSidebar);
            document.getElementById('closeSidebar').addEventListener('click', UI.toggleSidebar); // For mobile sidebar close button

            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', UI.toggleTheme);

            // Navigation Links (Smooth scrolling and active state)
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = e.target.closest('a').getAttribute('href').substring(1);
                    document.getElementById(targetId).scrollIntoView({ behavior: 'smooth' });

                    // Update active state
                    document.querySelectorAll('.nav-link').forEach(nav => nav.classList.remove('text-white', 'bg-primary'));
                    e.target.closest('a').classList.add('text-white', 'bg-primary');

                    // Hide sidebar on small screens after navigation
                    if (window.innerWidth < 768) {
                        UI.toggleSidebar();
                    }
                });
            });

            // Quick Actions
            document.querySelectorAll('.quick-action').forEach(button => {
                button.addEventListener('click', (e) => {
                    const action = e.target.dataset.action;
                    switch (action) {
                        case 'quickPick':
                            const game = document.getElementById('lotteryGame').value;
                            const generated = Lottery.generateSmartNumbers(game, { numTickets: 1, generationMethod: 'standard' });
                            if (generated.length > 0) {
                                UI.renderNumberBalls('generatedTickets', generated[0].main, generated[0].bonus);
                                Notifier.showNotification("Quick Pick generated!");
                            }
                            break;
                        case 'analyzeLast':
                            if (appState.historicalData.length > 0) {
                                const lastDraw = appState.historicalData[appState.historicalData.length - 1];
                                document.getElementById('numbersToAnalyze').value = [...lastDraw.main, ...lastDraw.bonus].join(', ');
                                document.getElementById('analyzerGame').value = 'powerball'; // Default or infer if possible
                                // Manually trigger analyze if the user's intent is to auto-analyze last
                                document.getElementById('analyzeNumbers').click();
                                Notifier.showNotification("Last historical draw loaded for analysis.");
                            } else {
                                Notifier.showNotification('No historical data to analyze!', 'warning');
                            }
                            break;
                        case 'checkOdds':
                            document.getElementById('probability').scrollIntoView({ behavior: 'smooth' });
                            Notifier.showNotification("Scrolled to Probability Lab.");
                            break;
                    }
                });
            });

            // Dashboard Charts (Initialize placeholders)
            dashboardHeatmapChart = UI.initChart(document.getElementById('dashboardHeatmap').getContext('2d'), 'bar', [], [], 'Frequency');
            dashboardPatternsChart = UI.initChart(document.getElementById('dashboardPatterns').getContext('2d'), 'line', [], [], 'Patterns');

            // Generator Section Logic
            const lotteryGameSelect = document.getElementById('lotteryGame');
            const customGameConfigDiv = document.getElementById('customGameConfig');

            lotteryGameSelect.addEventListener('change', () => {
                if (lotteryGameSelect.value === 'custom') {
                    customGameConfigDiv.classList.remove('hidden');
                } else {
                    customGameConfigDiv.classList.add('hidden');
                    // Update appState.gameConfig.custom with current values
                    const config = appState.gameConfig[lotteryGameSelect.value];
                    document.getElementById('mainPool').value = config.mainPool;
                    document.getElementById('pickCount').value = config.pickCount;
                    document.getElementById('bonusPool').value = config.bonusPool;
                    document.getElementById('bonusCount').value = config.bonusCount;
                }
            });

            document.getElementById('randomSeedBtn').addEventListener('click', () => {
                document.getElementById('randomSeed').value = Math.random().toString(36).substring(2, 10).toUpperCase();
                Notifier.showNotification("Random seed generated.");
            });

            document.getElementById('generateSmart').addEventListener('click', () => {
                const gameType = lotteryGameSelect.value;
                const options = {
                    numTickets: parseInt(document.getElementById('numTickets').value),
                    generationMethod: document.getElementById('generationMethod').value,
                    useHistorical: document.getElementById('useHistorical').checked,
                    favorHot: document.getElementById('favorHot').checked,
                    includeDue: document.getElementById('includeDue').checked,
                    avoidRepeats: document.getElementById('avoidRepeats').checked,
                    sumFilter: document.getElementById('sumFilter').value,
                    consecutiveFilter: document.getElementById('consecutiveFilter').value,
                    // Add custom seed if needed
                    randomSeed: document.getElementById('randomSeed').value
                };

                if (gameType === 'custom') {
                    appState.gameConfig.custom.mainPool = parseInt(document.getElementById('mainPool').value);
                    appState.gameConfig.custom.pickCount = parseInt(document.getElementById('pickCount').value);
                    appState.gameConfig.custom.bonusPool = parseInt(document.getElementById('bonusPool').value);
                    appState.gameConfig.custom.bonusCount = parseInt(document.getElementById('bonusCount').value);
                    // Basic validation for custom game
                    if (appState.gameConfig.custom.pickCount > appState.gameConfig.custom.mainPool ||
                        appState.gameConfig.custom.bonusCount > appState.gameConfig.custom.bonusPool) {
                        Notifier.showNotification("Custom game configuration is invalid. Pick count cannot exceed pool size.", "error");
                        return;
                    }
                }

                UI.showLoading('generatedTickets'); // Indicate loading within the results area
                const generated = Lottery.generateSmartNumbers(gameType, options);
                UI.hideLoading('generatedTickets');

                if (generated.length > 0) {
                    document.getElementById('generatedTickets').innerHTML = ''; // Clear previous
                    generated.forEach(ticket => {
                        const ticketDiv = document.createElement('div');
                        ticketDiv.className = 'flex flex-wrap gap-1 items-center bg-gray-200 dark:bg-gray-600 p-2 rounded-md shadow-sm';
                        const mainBalls = ticket.main.map(num => `<span class="number-ball">${num}</span>`).join('');
                        const bonusBalls = ticket.bonus.length > 0 ? ticket.bonus.map(num => `<span class="number-ball bonus-ball">${num}</span>`).join('') : '';
                        ticketDiv.innerHTML = `${mainBalls} ${bonusBalls}`;
                        document.getElementById('generatedTickets').appendChild(ticketDiv);
                        DataStore.addHistoricalDraw(ticket); // Save generated to history
                    });
                    Notifier.showNotification(`${generated.length} ticket(s) generated successfully!`, 'success');
                    
                    // Update Generator Analysis Charts
                    const allGeneratedNumbers = generated.flatMap(t => t.main.concat(t.bonus));
                    const freqMap = _.countBy(allGeneratedNumbers);
                    const labels = Object.keys(freqMap).sort((a,b) => a - b);
                    const data = labels.map(l => freqMap[l]);
                    UI.updateChart(numberFrequencyChart, labels, data, 'Number Frequency');

                    // Example sum distribution (for one ticket for simplicity)
                    const ticketSums = generated.map(t => Utils.calculateSum(t.main.concat(t.bonus)));
                    const sumLabels = Array.from(new Set(ticketSums)).sort((a,b) => a - b);
                    const sumData = sumLabels.map(s => ticketSums.filter(ts => ts === s).length);
                    UI.updateChart(sumAnalysisChart, sumLabels, sumData, 'Ticket Sums');

                    // Update Dashboard Stats and Charts
                    const totalNumbers = appState.historicalData.flatMap(d => d.main.concat(d.bonus));
                    const totalFreqMap = _.countBy(totalNumbers);
                    const dashLabels = Object.keys(totalFreqMap).sort((a,b) => a - b);
                    const dashData = dashLabels.map(l => totalFreqMap[l]);
                    UI.updateChart(dashboardHeatmapChart, dashLabels, dashData, 'Global Number Frequency');

                    const avgNumbers = _.mean(totalNumbers).toFixed(1);
                    const { odd, even } = Utils.countOddEven(totalNumbers);
                    document.getElementById('statsOverview').innerHTML = `
                        <p>Numbers Generated: ${totalNumbers.length}</p>
                        <p>Average Number: ${avgNumbers}</p>
                        <p>Odd/Even: ${odd}/${even}</p>
                    `;

                } else {
                    document.getElementById('generatedTickets').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Could not generate numbers with current settings.</p>';
                    Notifier.showNotification("Failed to generate numbers. Try adjusting filters.", "warning");
                }
            });

            document.getElementById('clearGenerator').addEventListener('click', () => {
                document.getElementById('generatedTickets').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Generate some numbers to see results</p>';
                document.getElementById('numTickets').value = 1;
                document.getElementById('randomSeed').value = '';
                // Clear charts
                UI.updateChart(numberFrequencyChart, [], [], '');
                UI.updateChart(sumAnalysisChart, [], [], '');
                UI.updateChart(patternAnalysisChart, [], [], '');
                Notifier.showNotification("Generator fields cleared.");
            });

            document.getElementById('exportTxt').addEventListener('click', () => {
                const ticketsHtml = Array.from(document.getElementById('generatedTickets').children).map(div => div.textContent.trim());
                if (ticketsHtml.length > 0 && ticketsHtml[0] !== 'Generate some numbers to see results') {
                    Utils.exportToTXT('lotto_tickets.txt', ticketsHtml);
                } else {
                    Notifier.showNotification('No tickets to export.', 'warning');
                }
            });

            document.getElementById('exportCsv').addEventListener('click', () => {
                const ticketsData = appState.historicalData; // Use actual historical data for CSV export
                if (ticketsData.length > 0) {
                     const formattedData = ticketsData.map(draw => ({
                        Date: draw.timestamp ? new Date(draw.timestamp).toLocaleDateString() : 'N/A',
                        MainNumbers: draw.main.join(' '),
                        BonusNumbers: draw.bonus.join(' '),
                        Sum: Utils.calculateSum(draw.main.concat(draw.bonus)),
                        OddEven: `${Utils.countOddEven(draw.main.concat(draw.bonus)).odd}/${Utils.countOddEven(draw.main.concat(draw.bonus)).even}`
                    }));
                    Utils.exportToCSV('lotto_tickets.csv', formattedData);
                } else {
                    Notifier.showNotification('No tickets to export to CSV.', 'warning');
                }
            });

            document.getElementById('copyTickets').addEventListener('click', () => {
                const ticketsHtml = Array.from(document.getElementById('generatedTickets').children).map(div => div.textContent.trim());
                if (ticketsHtml.length > 0 && ticketsHtml[0] !== 'Generate some numbers to see results') {
                    Utils.copyToClipboard(ticketsHtml.join('\n'));
                } else {
                    Notifier.showNotification('No tickets to copy.', 'warning');
                }
            });

            document.getElementById('saveTickets').addEventListener('click', () => {
                // Tickets are already saved to historicalData on generation, so this acts as a confirmation
                Notifier.showNotification('Generated tickets are automatically saved to Historical Data.', 'info');
            });


            // Initialize Generator Charts
            numberFrequencyChart = UI.initChart(document.getElementById('numberFrequencyChart').getContext('2d'), 'bar', [], [], 'Number Frequency');
            sumAnalysisChart = UI.initChart(document.getElementById('sumAnalysisChart').getContext('2d'), 'line', [], [], 'Sum Analysis');
            patternAnalysisChart = UI.initChart(document.getElementById('patternAnalysisChart').getContext('2d'), 'bar', [], [], 'Pattern Analysis'); // Placeholder

            // Analyzer Section Logic
            document.getElementById('analyzeNumbers').addEventListener('click', () => {
                const inputNumbersText = document.getElementById('numbersToAnalyze').value;
                const analyzerGameType = document.getElementById('analyzerGame').value;
                const { main: numbers, bonus: bonusNumbers } = Utils.parseNumbers(inputNumbersText, analyzerGameType);

                if (numbers.length === 0 && bonusNumbers.length === 0) {
                    Notifier.showNotification('Please enter numbers to analyze.', 'warning');
                    return;
                }

                const analysis = Lottery.analyzeNumbers(numbers, bonusNumbers, analyzerGameType);
                
                document.getElementById('analysisResults').innerHTML = `
                    <p><strong>Input Numbers:</strong> ${numbers.join(', ')} ${bonusNumbers.length > 0 ? `(+${bonusNumbers.join(', ')})` : ''}</p>
                    <p><strong>Game Type:</strong> ${analyzerGameType.toUpperCase()}</p>
                    <p><strong>Sum:</strong> ${analysis.sum}</p>
                    <p><strong>Odd/Even Ratio:</strong> ${analysis.oddEvenRatio}</p>
                    <p><strong>Min/Max:</strong> ${analysis.min}/${analysis.max}</p>
                    <p><strong>Average:</strong> ${analysis.average}</p>
                    <p><strong>Consecutive:</strong> ${analysis.isConsecutive ? 'Yes' : 'No'}</p>
                `;
                
                // Update Number Properties and Pattern Stats
                document.getElementById('numberProps').innerHTML = `
                    <p>Min: ${analysis.min}</p>
                    <p>Max: ${analysis.max}</p>
                    <p>Avg: ${analysis.average}</p>
                `;
                document.getElementById('patternStats').innerHTML = `
                    <p>Consecutive: ${analysis.isConsecutive ? 'Yes' : 'No'}</p>
                    <p>Odd/Even: ${analysis.oddEvenRatio}</p>
                `;
                UI.renderNumberBalls('visualAnalysis', numbers, bonusNumbers);

                // Update Analyzer Charts
                const allAnalyzedNumbers = numbers.concat(bonusNumbers);
                const freqMap = _.countBy(allAnalyzedNumbers);
                const freqLabels = Object.keys(freqMap).sort((a,b) => a - b);
                const freqData = freqLabels.map(l => freqMap[l]);
                UI.updateChart(freqDistributionChart, freqLabels, freqData, 'Number Frequency');

                const lastDigits = allAnalyzedNumbers.map(n => n % 10);
                const lastDigitFreq = _.countBy(lastDigits);
                const ldLabels = Object.keys(lastDigitFreq).sort((a,b) => a - b);
                const ldData = ldLabels.map(l => lastDigitFreq[l]);
                UI.updateChart(lastDigitDistributionChart, ldLabels, ldData, 'Last Digit Distribution');

                const sumOfDigits = allAnalyzedNumbers.map(n => String(n).split('').reduce((sum, digit) => sum + parseInt(digit), 0));
                const sumOfDigitsFreq = _.countBy(sumOfDigits);
                const sdLabels = Object.keys(sumOfDigitsFreq).sort((a,b) => a - b);
                const sdData = sdLabels.map(l => sumOfDigitsFreq[l]);
                UI.updateChart(sumDistributionChart, sdLabels, sdData, 'Sum of Digits Distribution');

                UI.updateChart(oddEvenDistributionChart, ['Odd', 'Even'], [analysis.odd, analysis.even], 'Odd/Even Distribution');

                Notifier.showNotification("Numbers analyzed successfully!", "success");
            });

            document.getElementById('getAIInsights').addEventListener('click', async () => {
                const inputNumbersText = document.getElementById('numbersToAnalyze').value;
                const analyzerGameType = document.getElementById('analyzerGame').value;
                const { main: numbers, bonus: bonusNumbers } = Utils.parseNumbers(inputNumbersText, analyzerGameType);

                if (numbers.length === 0 && bonusNumbers.length === 0) {
                    Notifier.showNotification('Please enter numbers for AI Insights.', 'warning');
                    return;
                }

                UI.showLoading('aiInsightsLoading');
                document.getElementById('aiInsightsOutput').classList.remove('hidden');
                document.getElementById('aiInsightsText').textContent = 'Analyzing with AI...';

                // Simulate AI processing
                await new Promise(resolve => setTimeout(resolve, 3000));

                const aiInsights = `Based on current patterns and statistical models, these numbers (${numbers.join(', ')} ${bonusNumbers.length > 0 ? `+${bonusNumbers.join(', ')}` : ''}) exhibit:
                - Strong balance in odd/even distribution.
                - A sum (${Utils.calculateSum(numbers.concat(bonusNumbers))}) that falls within the historical average for ${analyzerGameType}.
                - No immediate historical repeating patterns detected.
                - Moderate 'hot' numbers presence, indicating a blend of recent popular picks.
                For deeper analysis, consider the "Prediction Engine" section.`;
                
                document.getElementById('aiInsightsText').textContent = aiInsights;
                UI.hideLoading('aiInsightsLoading');
                Notifier.showNotification("AI insights generated.", "success");
            });

            document.getElementById('clearAnalyzer').addEventListener('click', () => {
                document.getElementById('numbersToAnalyze').value = '';
                document.getElementById('analysisResults').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Enter numbers to analyze them</p>';
                document.getElementById('numberProps').innerHTML = '';
                document.getElementById('patternStats').innerHTML = '';
                document.getElementById('visualAnalysis').innerHTML = '';
                document.getElementById('aiInsightsOutput').classList.add('hidden');
                document.getElementById('aiInsightsText').textContent = '';
                UI.updateChart(freqDistributionChart, [], [], '');
                UI.updateChart(lastDigitDistributionChart, [], [], '');
                UI.updateChart(sumDistributionChart, [], [], '');
                UI.updateChart(oddEvenDistributionChart, [], [], '');
                Notifier.showNotification("Analyzer fields cleared.");
            });

            document.querySelectorAll('.sample-input').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.getElementById('numbersToAnalyze').value = e.target.dataset.sample;
                    document.getElementById('analyzerGame').value = e.target.dataset.game;
                    Notifier.showNotification("Sample numbers loaded.");
                });
            });

            // Initialize Analyzer Charts
            freqDistributionChart = UI.initChart(document.getElementById('freqDistributionChart').getContext('2d'), 'bar', [], [], 'Number Frequency');
            lastDigitDistributionChart = UI.initChart(document.getElementById('lastDigitDistributionChart').getContext('2d'), 'bar', [], [], 'Last Digit Distribution');
            sumDistributionChart = UI.initChart(document.getElementById('sumDistributionChart').getContext('2d'), 'bar', [], [], 'Sum of Digits Distribution');
            oddEvenDistributionChart = UI.initChart(document.getElementById('oddEvenDistributionChart').getContext('2d'), 'pie', [], [], 'Odd/Even Distribution');

            // Seed Reverser Logic (Placeholder - actual seed reversal is complex and depends on PRNG)
            document.getElementById('reverseSeedBtn').addEventListener('click', async () => {
                const numbersToReverseText = document.getElementById('numbersToReverse').value;
                const seedGameType = document.getElementById('seedReverseGame').value;
                const { main: numbers, bonus: bonusNumbers } = Utils.parseNumbers(numbersToReverseText, seedGameType);

                if (numbers.length === 0 && bonusNumbers.length === 0) {
                    Notifier.showNotification('Please enter numbers for Seed Reversal.', 'warning');
                    return;
                }

                UI.showLoading('seedInterpretationLoading'); // Reusing loading indicator
                document.getElementById('seedProfileResults').innerHTML = '<p>Generating seed profile...</p>';
                document.getElementById('seedInterpretationOutput').classList.remove('hidden');
                document.getElementById('seedInterpretationText').textContent = 'Analyzing...';

                await new Promise(resolve => setTimeout(resolve, 2500)); // Simulate work

                // Placeholder logic: Real seed reversal is often impossible or requires knowing the exact PRNG state/algorithm.
                // For a web app, this would be a "profile generation" based on the input numbers' characteristics.
                const profile = {
                    entropyEstimate: (Math.random() * 100).toFixed(2), // Simulate entropy
                    patternComplexity: 'Medium',
                    distributionBias: 'Slightly skewed to lower numbers',
                    hypotheticalSeedCandidate: `0x${Math.random().toString(16).substring(2, 10).toUpperCase()}`
                };

                document.getElementById('seedProfileResults').innerHTML = `
                    <p><strong>Entropy Estimate:</strong> ${profile.entropyEstimate}%</p>
                    <p><strong>Pattern Complexity:</strong> ${profile.patternComplexity}</p>
                    <p><strong>Distribution Bias:</strong> ${profile.distributionBias}</p>
                    <p><strong>Hypothetical Seed Candidate:</strong> <code>${profile.hypotheticalSeedCandidate}</code></p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2">Note: True random seed reversal is mathematically complex and often not feasible without the original PRNG state.</p>
                `;
                document.getElementById('seedStats').innerHTML = `
                    <p>Entropy: ${profile.entropyEstimate}%</p>
                    <p>Bias: ${profile.distributionBias}</p>
                `;
                document.getElementById('seedPatterns').innerHTML = `
                    <p>Complexity: ${profile.patternComplexity}</p>
                `;
                UI.renderNumberBalls('seedVisuals', numbers, bonusNumbers);

                UI.hideLoading('seedInterpretationLoading');
                Notifier.showNotification("Seed profile generated.", "success");
            });

            document.getElementById('interpretSeedProfile').addEventListener('click', async () => {
                const seedProfileText = document.getElementById('seedProfileResults').textContent; // Get content from previous step
                if (!seedProfileText || seedProfileText.includes('Enter numbers')) {
                    Notifier.showNotification('Generate a seed profile first before interpreting.', 'warning');
                    return;
                }

                UI.showLoading('seedInterpretationLoading');
                document.getElementById('seedInterpretationOutput').classList.remove('hidden');
                document.getElementById('seedInterpretationText').textContent = 'Interpreting profile with AI...';

                await new Promise(resolve => setTimeout(resolve, 3000));

                const interpretation = `AI interpretation suggests that the entered number sequence, while appearing random, shows a minor bias towards certain number ranges (e.g., lower numbers). The hypothetical seed candidate is a mathematical representation for potential future pattern prediction, but its real-world applicability depends heavily on the true lottery drawing mechanism. It's crucial to remember that lotteries are designed to be truly random, making precise seed reversal extremely difficult if not impossible for actual draws.`;

                document.getElementById('seedInterpretationText').textContent = interpretation;
                UI.hideLoading('seedInterpretationLoading');
                Notifier.showNotification("AI interpretation complete.", "success");
            });

            document.getElementById('clearSeedReverse').addEventListener('click', () => {
                document.getElementById('numbersToReverse').value = '';
                document.getElementById('seedProfileResults').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Enter numbers and generate profile</p>';
                document.getElementById('seedStats').innerHTML = '';
                document.getElementById('seedPatterns').innerHTML = '';
                document.getElementById('seedVisuals').innerHTML = '';
                document.getElementById('seedInterpretationOutput').classList.add('hidden');
                document.getElementById('seedInterpretationText').textContent = '';
                Notifier.showNotification("Seed reverser fields cleared.");
            });

            // Historical Data Logic
            const dataSourceSelect = document.getElementById('dataSource');
            const csvUploadContainer = document.getElementById('csvUploadContainer');

            dataSourceSelect.addEventListener('change', () => {
                if (dataSourceSelect.value === 'csv') {
                    csvUploadContainer.classList.remove('hidden');
                } else {
                    csvUploadContainer.classList.add('hidden');
                }
            });

            document.getElementById('loadData').addEventListener('click', () => {
                const historicalGame = document.getElementById('historicalGame').value;
                const dataSource = document.getElementById('dataSource').value;
                const pastDrawsCount = document.getElementById('pastDraws').value;

                // Simulate data loading
                UI.showLoading('dataSummary');
                document.getElementById('historicalTable').querySelector('tbody').innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400">Loading data...</td></tr>';

                setTimeout(() => {
                    let loadedData = [];
                    if (dataSource === 'sample') {
                        // Generate sample historical data
                        const config = appState.gameConfig[historicalGame];
                        for (let i = 0; i < (pastDrawsCount === 'all' ? 200 : parseInt(pastDrawsCount)); i++) {
                            const date = new Date(Date.now() - (i * 7 * 24 * 60 * 60 * 1000)); // Weekly draws
                            const main = Utils.generateRandomNumbers(config.pickCount, config.mainPool);
                            const bonus = config.bonusCount > 0 ? Utils.generateRandomNumbers(config.bonusCount, config.bonusPool) : [];
                            loadedData.push({
                                timestamp: date.toISOString(),
                                date: date.toLocaleDateString(),
                                numbers: main,
                                bonus: bonus,
                                sum: Utils.calculateSum([...main, ...bonus]),
                                oddEven: Utils.countOddEven([...main, ...bonus])
                            });
                        }
                    } else if (dataSource === 'csv') {
                        const csvFile = document.getElementById('csvUpload').files[0];
                        if (csvFile) {
                            DataStore.importData(csvFile); // This will handle loading and state update
                            Notifier.showNotification("CSV data processing initiated.");
                            UI.hideLoading('dataSummary');
                            return; // Exit as importData reloads the page
                        } else {
                            Notifier.showNotification('Please select a CSV file to upload.', 'warning');
                            UI.hideLoading('dataSummary');
                            return;
                        }
                    } else if (dataSource === 'api') {
                        Notifier.showNotification("Live API data loading (Premium feature - not implemented).", "info");
                        // In a real app, this would be an AJAX call to an external API
                        UI.hideLoading('dataSummary');
                        return;
                    }

                    appState.historicalData = loadedData; // Update global state
                    DataStore.saveState(); // Save to local storage

                    // Render table
                    const tableBody = document.getElementById('historicalTable').querySelector('tbody');
                    tableBody.innerHTML = '';
                    if (loadedData.length > 0) {
                        loadedData.forEach(draw => {
                            const row = tableBody.insertRow();
                            row.insertCell().textContent = draw.date;
                            row.insertCell().innerHTML = draw.numbers.map(n => `<span class="number-ball !w-8 !h-8 !text-sm !font-semibold">${n}</span>`).join('');
                            row.insertCell().innerHTML = draw.bonus.length > 0 ? draw.bonus.map(n => `<span class="number-ball bonus-ball !w-8 !h-8 !text-sm !font-semibold">${n}</span>`).join('') : 'N/A';
                            row.insertCell().textContent = draw.sum;
                            row.insertCell().textContent = `${draw.oddEven.odd}/${draw.oddEven.even}`;
                        });
                        Notifier.showNotification(`${loadedData.length} historical draws loaded.`, "success");
                    } else {
                        tableBody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400">No data available for selected criteria.</td></tr>';
                        Notifier.showNotification("No historical data found.", "warning");
                    }

                    // Update Data Summary and Quick Analysis
                    const allNumbersFlat = loadedData.flatMap(d => d.numbers.concat(d.bonus));
                    const freqMap = _.countBy(allNumbersFlat);
                    const sortedFreq = Object.entries(freqMap).sort(([, a], [, b]) => b - a);

                    document.getElementById('dataSummary').innerHTML = `
                        <p>Total Draws: ${loadedData.length}</p>
                        <p>Game Type: ${historicalGame.toUpperCase()}</p>
                        <p>Date Range: ${loadedData.length > 0 ? `${loadedData[loadedData.length - 1].date} - ${loadedData[0].date}` : 'N/A'}</p>
                    `;
                    document.getElementById('mostFrequent').innerHTML = sortedFreq.slice(0, 5).map(([num, count]) => `<p>${num} (${count})</p>`).join('');
                    document.getElementById('leastFrequent').innerHTML = sortedFreq.slice(-5).map(([num, count]) => `<p>${num} (${count})</p>`).reverse().join('');
                    
                    // Simple Due Numbers (e.g., numbers not seen in last 10 draws)
                    const recent10DrawsNumbers = loadedData.slice(0, 10).flatMap(d => d.numbers.concat(d.bonus));
                    const allPossibleNumbers = Array.from({length: appState.gameConfig[historicalGame].mainPool}, (_, i) => i + 1);
                    const dueNums = allPossibleNumbers.filter(n => !recent10DrawsNumbers.includes(n));
                    document.getElementById('dueNumbers').innerHTML = dueNums.length > 0 ? dueNums.slice(0, 10).join(', ') + (dueNums.length > 10 ? '...' : '') : 'None';

                    // Update Historical Charts
                    const historicalLabels = Object.keys(freqMap).sort((a,b) => a - b);
                    const historicalData = historicalLabels.map(l => freqMap[l]);
                    UI.updateChart(freqHeatmapHistoricalChart, historicalLabels, historicalData, 'Historical Frequency');

                    // Frequency Over Time (example: show frequency of one number over draws)
                    // This would require more complex data structuring and iteration
                    UI.updateChart(freqOverTimeChart, [], [], 'Freq Over Time'); // Placeholder

                    // Gap Analysis (placeholder)
                    UI.updateChart(gapAnalysisChart, [], [], 'Gap Analysis'); // Placeholder

                    UI.hideLoading('dataSummary');

                }, 1000); // Simulate network delay
            });

            document.getElementById('clearHistorical').addEventListener('click', () => {
                appState.historicalData = [];
                DataStore.saveState();
                document.getElementById('dataSummary').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Load historical data to see summary</p>';
                document.getElementById('mostFrequent').innerHTML = '';
                document.getElementById('leastFrequent').innerHTML = '';
                document.getElementById('dueNumbers').innerHTML = '';
                document.getElementById('recentTrends').innerHTML = '';
                document.getElementById('patternFrequency').innerHTML = '';
                document.getElementById('sumStatistics').innerHTML = '';
                document.getElementById('historicalTable').querySelector('tbody').innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500 dark:text-gray-400">Load data to view historical draws</td></tr>';
                UI.updateChart(freqHeatmapHistoricalChart, [], [], '');
                UI.updateChart(freqOverTimeChart, [], [], '');
                UI.updateChart(gapAnalysisChart, [], [], '');
                Notifier.showNotification("Historical data cleared.", "success");
            });

            document.getElementById('exportHistorical').addEventListener('click', () => {
                if (appState.historicalData.length > 0) {
                    const formattedData = appState.historicalData.map(draw => ({
                        Date: draw.timestamp ? new Date(draw.timestamp).toLocaleDateString() : 'N/A',
                        MainNumbers: draw.numbers.join(' '),
                        BonusNumbers: draw.bonus.join(' '),
                        Sum: draw.sum,
                        OddEven: `${draw.oddEven.odd}/${draw.oddEven.even}`
                    }));
                    Utils.exportToCSV('lotto_historical_data.csv', formattedData);
                } else {
                    Notifier.showNotification('No historical data to export.', 'warning');
                }
            });

            // Initialize Historical Charts
            freqHeatmapHistoricalChart = UI.initChart(document.getElementById('freqHeatmapChart').getContext('2d'), 'bar', [], [], 'Number Frequency Heatmap');
            freqOverTimeChart = UI.initChart(document.getElementById('freqOverTimeChart').getContext('2d'), 'line', [], [], 'Frequency Over Time');
            gapAnalysisChart = UI.initChart(document.getElementById('gapAnalysisChart').getContext('2d'), 'bar', [], [], 'Gap Analysis');

            // AI Strategies Logic
            document.querySelectorAll('.applyStrategy').forEach(button => {
                button.addEventListener('click', (e) => {
                    const strategy = e.target.dataset.strategy;
                    if (appState.historicalData.length === 0) {
                        Notifier.showNotification('Load historical data first to apply strategies.', 'warning');
                        return;
                    }
                    UI.showLoading('strategyResults');
                    document.getElementById('strategyResults').textContent = `Applying ${strategy} strategy...`;
                    document.getElementById('recommendedNumbers').innerHTML = '';
                    document.getElementById('strategyAnalysis').innerHTML = '';

                    setTimeout(() => {
                        const config = appState.gameConfig[document.getElementById('lotteryGame').value]; // Assuming generator game type
                        let recommended = [];
                        let analysisText = '';

                        // Simple strategy implementation (actual AI would be complex)
                        if (strategy === 'frequency') {
                            const allNumbers = appState.historicalData.flatMap(d => d.numbers.concat(d.bonus));
                            const freqMap = _.countBy(allNumbers);
                            const sortedFreq = Object.entries(freqMap).sort(([, a], [, b]) => b - a);
                            recommended = sortedFreq.slice(0, config.pickCount).map(([num]) => Number(num));
                            analysisText = `Numbers selected based on highest historical frequency. Top ${config.pickCount} numbers: ${recommended.join(', ')}.`;
                        } else if (strategy === 'gap') {
                            // Find numbers that haven't appeared for the longest time
                            const lastAppearance = {};
                            appState.historicalData.forEach((draw, index) => {
                                draw.numbers.concat(draw.bonus).forEach(num => {
                                    if (!(num in lastAppearance)) {
                                        lastAppearance[num] = index; // Store index of last appearance
                                    }
                                });
                            });
                            const currentDrawIndex = appState.historicalData.length;
                            const sortedByGap = Object.entries(lastAppearance).map(([num, lastIndex]) => ({
                                num: Number(num),
                                gap: currentDrawIndex - lastIndex
                            })).sort((a, b) => b.gap - a.gap);
                            recommended = sortedByGap.slice(0, config.pickCount).map(item => item.num);
                            analysisText = `Numbers selected based on longest 'gap' since last appearance. These numbers are statistically 'due'.`;
                        } else if (strategy === 'pattern') {
                            // Simplified pattern (e.g., favor numbers that appeared in a popular pattern)
                            // This would be very complex in a real scenario (e.g., Markov chains, deep learning)
                            recommended = Lottery.generateNumbersWithBias(config.pickCount, config.mainPool, appState.historicalData, { useHistorical: true, favorHot: true, includeDue: true });
                            analysisText = `A blend of statistical patterns and hot/due numbers have been used for recommendations.`;
                        }

                        UI.renderNumberBalls('recommendedNumbers', recommended);
                        document.getElementById('strategyAnalysis').textContent = analysisText;
                        document.getElementById('strategyResults').innerHTML = `<p>Strategy Applied: <strong>${strategy}</strong></p>`;
                        UI.hideLoading('strategyResults');
                        Notifier.showNotification("Strategy applied successfully!", "success");
                    }, 1500);
                });
            });

            document.getElementById('buildStrategy').addEventListener('click', () => {
                Notifier.showNotification("Custom Strategy Builder logic needs to be implemented. This would combine selected components with their weights.", "info");
                // Implement logic to combine selected components and their weights
                // This would then call a more advanced version of Lottery.generateSmartNumbers or a new function
            });

            // Range slider value display for custom strategy
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                const valueSpan = document.getElementById(slider.id + 'Value');
                slider.addEventListener('input', () => {
                    valueSpan.textContent = `${slider.value}%`;
                });
            });

            // Probability Lab Logic
            document.getElementById('calculateProbability').addEventListener('click', () => {
                const gameType = document.getElementById('probabilityGame').value;
                const mainMatches = parseInt(document.getElementById('calcMainMatch').value);
                const bonusMatches = parseInt(document.getElementById('calcBonusMatch').value);

                if (isNaN(mainMatches) || isNaN(bonusMatches) || mainMatches < 0 || bonusMatches < 0) {
                    Notifier.showNotification('Please enter valid numbers for matches.', 'warning');
                    return;
                }

                const probability = Lottery.calculateProbability(gameType, mainMatches, bonusMatches);
                document.getElementById('probabilityResults').innerHTML = `
                    <p><strong>Game:</strong> ${gameType.toUpperCase()}</p>
                    <p><strong>Matches:</strong> ${mainMatches} Main, ${bonusMatches} Bonus</p>
                    <p><strong>Odds:</strong> ${probability}</p>
                `;

                // Update Probability Chart (example: fixed bars for now)
                UI.updateChart(probabilityChart, ['Your Odds', 'Against You'], [1, 1000000], 'Probability'); // Example
                Notifier.showNotification("Probability calculated.", "success");
            });

            document.getElementById('clearProbability').addEventListener('click', () => {
                document.getElementById('calcMainMatch').value = 0;
                document.getElementById('calcBonusMatch').value = 0;
                document.getElementById('probabilityResults').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Enter criteria to calculate probability</p>';
                UI.updateChart(probabilityChart, [], [], '');
                Notifier.showNotification("Probability calculator cleared.");
            });

            // Initialize Probability Chart
            probabilityChart = UI.initChart(document.getElementById('probabilityChart').getContext('2d'), 'bar', [], [], 'Probability');

            // Prediction Engine Logic
            document.getElementById('generatePrediction').addEventListener('click', async () => {
                const predictionGame = document.getElementById('predictionGame').value;
                const predictionModel = document.getElementById('predictionModel').value;

                UI.renderNumberBalls('predictionResults', []);
                document.getElementById('predictionDetails').classList.add('hidden');

                const { predictedMain, predictedBonus, confidence, details } = await Lottery.predictNumbers(predictionGame, predictionModel);

                if (predictedMain.length > 0 || predictedBonus.length > 0) {
                    UI.renderNumberBalls('predictionResults', predictedMain, predictedBonus);
                    document.getElementById('predictionDetailsText').textContent = details;
                    document.getElementById('predictionDetails').classList.remove('hidden');

                    // Update Prediction Confidence Chart
                    UI.updateChart(predictionConfidenceChart, ['Confidence'], [confidence], 'Prediction Confidence');
                    Notifier.showNotification("Prediction generated successfully!", "success");
                } else {
                    document.getElementById('predictionResults').innerHTML = '<p class="text-gray-500 dark:text-gray-400">Could not generate prediction.</p>';
                    Notifier.showNotification("Failed to generate prediction.", "error");
                }
            });

            document.getElementById('clearPrediction').addEventListener('click', () => {
                UI.renderNumberBalls('predictionResults', []);
                document.getElementById('predictionDetails').classList.add('hidden');
                document.getElementById('predictionDetailsText').textContent = '';
                UI.updateChart(predictionConfidenceChart, [], [], '');
                Notifier.showNotification("Prediction engine cleared.");
            });

            // Initialize Prediction Chart
            predictionConfidenceChart = UI.initChart(document.getElementById('predictionConfidenceChart').getContext('2d'), 'bar', [], [], 'Prediction Confidence');

            // Settings Logic
            document.getElementById('exportAllData').addEventListener('click', DataStore.exportAllData);
            document.getElementById('clearAllData').addEventListener('click', DataStore.clearAllData);
            document.getElementById('importData').addEventListener('click', () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    if (e.target.files.length > 0) {
                        DataStore.importData(e.target.files[0]);
                    }
                };
                input.click();
            });

            // Notification button listener (for opening a notification panel, if implemented)
            document.getElementById('notificationsBtn').addEventListener('click', () => {
                // This would ideally open a modal or slide-out panel showing all notifications
                Notifier.showNotification("Notifications panel is not fully implemented yet.", "info");
                Notifier.markAllAsRead();
            });

            // Initial active navigation link and scroll to dashboard
            document.querySelector('.nav-link[href="#dashboard"]').classList.add('text-white', 'bg-primary');
            document.getElementById('dashboard').scrollIntoView();
        });

        // Global Error Handling
        window.onerror = (message, source, lineno, colno, error) => {
            console.error("Global Error:", message, source, lineno, colno, error);
            Notifier.showNotification(`An unexpected error occurred: ${message.substring(0, 100)}...`, 'error', 5000);
            return true; // Suppress default error reporting
        };

        window.addEventListener('unhandledrejection', (event) => {
            console.error("Unhandled Promise Rejection:", event.reason);
            Notifier.showNotification(`An operation failed: ${event.reason.message || event.reason}...`, 'error', 5000);
        });

    </script>
</body>
</html>
